<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Modular Quiz App</title>
    <link rel="stylesheet" href="../../shared/common.css">
    <link rel="stylesheet" href="admin.css">
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
    
    <!-- Load Logger first, then APIClient -->
    <script src="../../shared/logger.js"></script>
    <script src="../../shared/api-client.js?v=20250807-admin-fixed"></script>
</head>
<body class="no-navigation no-breadcrumb">
    <!-- Notifications Container -->
    <div id="notifications" class="notifications-container"></div>
    
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1>üõ†Ô∏è Admin Panel</h1>
            <div class="user-info">
                <span id="userDisplay">üë§ Loading...</span>
                <span id="userRole" class="user-role"></span>
                <button id="toggleApiTest" class="btn btn-secondary" onclick="document.getElementById('api-test-section').style.display = document.getElementById('api-test-section').style.display === 'none' ? 'block' : 'none'" style="margin-right: 10px;">üîß API Test</button>
                <button id="logoutBtn" class="btn btn-secondary">Odhl√°sit</button>
            </div>
        </div>
        
        <!-- Navigation Breadcrumbs / Status Bar -->
        <nav class="breadcrumbs">
            <div class="status-left">
                <div id="navigation-links-container"></div>
                <span class="separator">|</span>
                <span class="current">üõ†Ô∏è Admin Panel</span>
                <span class="separator">|</span>
                <span id="statusText">Admin syst√©m - Monitoring a spr√°va</span>
            </div>
            <div class="status-right">
                <div class="server-status" id="serverStatus">
                    <span class="status-indicator" id="statusIndicator">üî¥</span>
                    <span class="status-text" id="statusIndicatorText">Offline</span>
                    <span class="status-mode" id="statusMode">Local Mode</span>
                </div>
            </div>
        </nav>
    </header>

    <!-- Access Control Warning -->
    <div id="accessWarning" class="access-warning" style="display: none;">
        <div class="warning-content">
            <h3>‚ö†Ô∏è Omezen√Ω p≈ô√≠stup</h3>
            <p>Pro p≈ô√≠stup k admin panelu pot≈ôebujete admin opr√°vnƒõn√≠.</p>
            <button onclick="window.location.href='../auth/login.html'" class="btn btn-primary">
                P≈ôihl√°sit jako Admin
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content" id="adminContent">

        <!-- Admin Dashboard -->
        <section class="admin-dashboard">
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-content">
                        <h3 id="totalUsers">0</h3>
                        <p>Celkem u≈æivatel≈Ø</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üìö</div>
                    <div class="stat-content">
                        <h3 id="totalTables">0</h3>
                        <p>Tabulek ot√°zek</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">‚ùì</div>
                    <div class="stat-content">
                        <h3 id="totalQuestions">0</h3>
                        <p>Celkem ot√°zek</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-content">
                        <h3 id="totalAnswers">0</h3>
                        <p>Odpovƒõd√≠ dnes</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin Tabs -->
        <section class="admin-tabs">
            <div class="tab-buttons">
                <button class="tab-btn active" data-tab="users">üë• U≈æivatel√©</button>
                <button class="tab-btn" data-tab="questions">‚ùì Ot√°zky</button>
                <button class="tab-btn" data-tab="tables">üìö Tabulky</button>
                <button class="tab-btn" data-tab="analytics">üìä Analytika</button>
                <button class="tab-btn" data-tab="system">‚öôÔ∏è Syst√©m</button>
            </div>
            
            <!-- Users Tab -->
            <div id="users-tab" class="tab-content active">
                <div class="tab-header">
                    <h2>üë• Spr√°va U≈æivatel≈Ø</h2>
                    <div class="tab-actions">
                        <button id="refreshUsersBtn" class="btn btn-secondary">üîÑ Obnovit</button>
                    </div>
                </div>
                
                <!-- Add User Panel - Collapsible -->
                <div class="admin-panel collapsed" id="addUserPanel">
                    <div class="panel-header" onclick="togglePanel('addUserPanel')">
                        <h3>‚ûï P≈ôidat nov√©ho u≈æivatele</h3>
                        <span class="panel-toggle">‚ñº</span>
                    </div>
                    <div class="panel-content">
                        <form id="addUserForm" class="panel-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="newUsername" class="form-label">U≈æivatelsk√© jm√©no:</label>
                                    <input type="text" id="newUsername" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label for="newUserEmail" class="form-label">Email:</label>
                                    <input type="email" id="newUserEmail" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label for="newUserPassword" class="form-label">Heslo:</label>
                                    <input type="password" id="newUserPassword" class="form-input" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="newUserRole" class="form-label">Role:</label>
                                    <select id="newUserRole" class="form-select" required>
                                        <option value="">Vyberte roli</option>
                                        <option value="user">U≈æivatel</option>
                                        <option value="admin">Administr√°tor</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <button type="submit" class="btn btn-primary">‚ûï Vytvo≈ôit u≈æivatele</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="users-table-container">
                    <table class="admin-table" id="usersTable">
                        <thead>
                            <tr>
                                <th>U≈æivatel</th>
                                <th>Role</th>
                                <th>Registrace</th>
                                <th>Posledn√≠ aktivita</th>
                                <th>Spr√°vnƒõ/≈†patnƒõ</th>
                                <th>Akce</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Questions Tab -->
            <div id="questions-tab" class="tab-content">
                <div class="tab-header">
                    <h2>‚ùì Spr√°va Ot√°zek</h2>
                    <div class="tab-actions">
                        <select id="questionTableFilter" class="form-select">
                            <option value="">V≈°echny tabulky</option>
                        </select>
                        <button id="refreshQuestionsBtn" class="btn btn-secondary">üîÑ Obnovit</button>
                        <button id="importQuestionsBtn" class="btn btn-primary">üìÅ Import</button>
                    </div>
                </div>
                
                <!-- Add Question Panel - Collapsible -->
                <div class="admin-panel collapsed" id="addQuestionPanel">
                    <div class="panel-header" onclick="togglePanel('addQuestionPanel')">
                        <h3>‚ûï P≈ôidat novou ot√°zku</h3>
                        <span class="panel-toggle">‚ñº</span>
                    </div>
                    <div class="panel-content">
                        <form id="addQuestionForm" class="panel-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="questionTable" class="form-label">Tabulka:</label>
                                    <select id="questionTable" class="form-select" required>
                                        <option value="">Vyberte tabulku</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="correctAnswer" class="form-label">Spr√°vn√° odpovƒõƒè:</label>
                                    <select id="correctAnswer" class="form-select" required>
                                        <option value="">Vyberte</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="questionDifficulty" class="form-label">Obt√≠≈ænost:</label>
                                    <select id="questionDifficulty" class="form-select">
                                        <option value="easy">Lehk√°</option>
                                        <option value="medium">St≈ôedn√≠</option>
                                        <option value="hard">Tƒõ≈æk√°</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="questionText" class="form-label">Ot√°zka:</label>
                                <textarea id="questionText" class="form-textarea" rows="3" required placeholder="Zadejte text ot√°zky..."></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="answerA" class="form-label">Odpovƒõƒè A:</label>
                                    <input type="text" id="answerA" class="form-input" required placeholder="Mo≈ænost A">
                                </div>
                                <div class="form-group">
                                    <label for="answerB" class="form-label">Odpovƒõƒè B:</label>
                                    <input type="text" id="answerB" class="form-input" required placeholder="Mo≈ænost B">
                                </div>
                                <div class="form-group">
                                    <label for="answerC" class="form-label">Odpovƒõƒè C:</label>
                                    <input type="text" id="answerC" class="form-input" required placeholder="Mo≈ænost C">
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">‚ûï P≈ôidat ot√°zku</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="questions-table-container">
                    <table class="admin-table" id="questionsTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Tabulka</th>
                                <th>Ot√°zka</th>
                                <th>Spr√°vn√° odpovƒõƒè</th>
                                <th>Obt√≠≈ænost</th>
                                <th>Akce</th>
                            </tr>
                        </thead>
                        <tbody id="questionsTableBody">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Tables Tab -->
            <div id="tables-tab" class="tab-content">
                <div class="tab-header">
                    <h2>üìö Spr√°va Tabulek</h2>
                    <div class="tab-actions">
                        <button id="refreshTablesBtn" class="btn btn-secondary">üîÑ Obnovit</button>
                        <button id="addTableBtn" class="btn btn-primary">‚ûï Vytvo≈ôit tabulku</button>
                    </div>
                </div>
                
                <div class="tables-grid" id="tablesGrid">
                    <!-- Dynamic content -->
                </div>
            </div>
            
            <!-- Analytics Tab -->
            <div id="analytics-tab" class="tab-content">
                <div class="tab-header">
                    <h2>üìä Analytika a Statistiky</h2>
                    <div class="tab-actions">
                        <select id="analyticsTimeRange" class="form-select">
                            <option value="today">Dnes</option>
                            <option value="week">Tento t√Ωden</option>
                            <option value="month">Tento mƒõs√≠c</option>
                            <option value="all">V≈°e</option>
                        </select>
                        <button id="refreshAnalyticsBtn" class="btn btn-secondary">üîÑ Obnovit</button>
                        <button id="exportDataBtn" class="btn btn-primary">üì§ Export dat</button>
                    </div>
                </div>
                
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3>üìà Aktivita u≈æivatel≈Ø</h3>
                        <div class="chart-container">
                            <canvas id="userActivityChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="analytics-card">
                        <h3>üéØ √öspƒõ≈°nost ot√°zek</h3>
                        <div class="chart-container">
                            <canvas id="questionSuccessChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="analytics-card">
                        <h3>‚öîÔ∏è Battle statistiky</h3>
                        <div id="battleStats" class="battle-stats">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                    
                    <div class="analytics-card">
                        <h3>üèÜ Top u≈æivatel√©</h3>
                        <div id="topUsers" class="top-users-list">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- System Tab -->
            <div id="system-tab" class="tab-content">
                <div class="tab-header">
                    <h2>‚öôÔ∏è Syst√©mov√° Administrace</h2>
                    <div class="tab-actions">
                        <button id="systemInfoBtn" class="btn btn-secondary">‚ÑπÔ∏è Info</button>
                        <button id="cleanupBtn" class="btn btn-warning">üßπ Vyƒçistit data</button>
                    </div>
                </div>
                
                <div class="system-grid">
                    <div class="system-card">
                        <h3>üîß √ödr≈æba datab√°ze</h3>
                        <div class="system-actions">
                            <button id="backupDbBtn" class="btn btn-primary">üíæ Z√°lohovat DB</button>
                            <button id="repairDbBtn" class="btn btn-warning">üîß Opravit DB</button>
                            <button id="optimizeDbBtn" class="btn btn-secondary">‚ö° Optimalizovat</button>
                        </div>
                    </div>
                    
                    <div class="system-card">
                        <h3>üìä Syst√©mov√© metriky</h3>
                        <div id="systemMetrics" class="metrics-list">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                    
                    <div class="system-card">
                        <h3>üîê Bezpeƒçnost</h3>
                        <div class="system-actions">
                            <button id="auditLogBtn" class="btn btn-secondary">üìù Audit log</button>
                            <button id="resetPasswordsBtn" class="btn btn-danger">üîë Reset hesel</button>
                            <button id="lockAccountBtn" class="btn btn-danger">üö´ Zablokovat √∫ƒçty</button>
                        </div>
                    </div>
                    
                    <div class="system-card">
                        <h3>üöÄ Server management</h3>
                        <div class="server-status" id="serverStatus">
                            <div class="status-indicator">üî¥ Offline</div>
                            <div class="status-details">
                                <p>Backend server: <span id="backendStatus">Checking...</span></p>
                                <p>Database: <span id="databaseStatus">Checking...</span></p>
                                <p>Verze: <span id="serverVersion">Unknown</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï P≈ôidat nov√©ho u≈æivatele</h3>
                <button class="modal-close" onclick="closeModal('addUserModal')">√ó</button>
            </div>
            
            <form id="addUserForm" class="modal-body">
                <div class="form-group">
                    <label for="newUsername">U≈æivatelsk√© jm√©no:</label>
                    <input type="text" id="newUsername" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="newUserEmail">Email:</label>
                    <input type="email" id="newUserEmail" class="form-input">
                </div>
                <div class="form-group">
                    <label for="newUserPassword">Heslo:</label>
                    <input type="password" id="newUserPassword" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="newUserRole">Role:</label>
                    <select id="newUserRole" class="form-select">
                        <option value="user">U≈æivatel</option>
                        <option value="admin">Administr√°tor</option>
                    </select>
                </div>
            </form>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('addUserModal')">
                    Zru≈°it
                </button>
                <button type="submit" form="addUserForm" class="btn btn-primary">
                    ‚ûï Vytvo≈ôit u≈æivatele
                </button>
            </div>
        </div>
    </div>

    <!-- Add Question Modal -->
    <div id="addQuestionModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>‚ûï P≈ôidat novou ot√°zku</h3>
                <button class="modal-close" onclick="closeModal('addQuestionModal')">√ó</button>
            </div>
            
            <form id="addQuestionForm" class="modal-body">
                <div class="form-group">
                    <label for="questionTable">Tabulka:</label>
                    <select id="questionTable" class="form-select" required>
                        <option value="">Vyberte tabulku</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="questionText">Ot√°zka:</label>
                    <textarea id="questionText" class="form-textarea" rows="3" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="answerA">Odpovƒõƒè A:</label>
                        <input type="text" id="answerA" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="answerB">Odpovƒõƒè B:</label>
                        <input type="text" id="answerB" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="answerC">Odpovƒõƒè C:</label>
                        <input type="text" id="answerC" class="form-input" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="correctAnswer">Spr√°vn√° odpovƒõƒè:</label>
                        <select id="correctAnswer" class="form-select" required>
                            <option value="">Vyberte</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="questionDifficulty">Obt√≠≈ænost:</label>
                        <select id="questionDifficulty" class="form-select">
                            <option value="easy">Snadn√°</option>
                            <option value="medium" selected>St≈ôedn√≠</option>
                            <option value="hard">Tƒõ≈æk√°</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="questionExplanation">Vysvƒõtlen√≠:</label>
                    <textarea id="questionExplanation" class="form-textarea" rows="2"></textarea>
                </div>
            </form>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('addQuestionModal')">
                    Zru≈°it
                </button>
                <button type="submit" form="addQuestionForm" class="btn btn-primary">
                    ‚ûï P≈ôidat ot√°zku
                </button>
            </div>
        </div>
    </div>

    <!-- API Test Section -->
    <div id="api-test-section" style="position: fixed; bottom: 20px; right: 20px; background: rgba(0,0,0,0.9); color: white; padding: 15px; border-radius: 10px; font-family: 'Courier New', monospace; font-size: 12px; z-index: 1000; width: 300px; border: 2px solid #00ff00; display: none;">
        <div style="display: flex; align-items: center; margin-bottom: 10px;">
            <div id="adminStatusIndicator" style="width: 10px; height: 10px; border-radius: 50%; background: #ff0000; margin-right: 10px;"></div>
            <strong>Admin API Test Panel</strong>
        </div>
        <button id="api-test-btn" onclick="runAdminAPIClientTest()" style="background: #00aa00; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; width: 100%; margin-bottom: 10px; font-weight: bold;">
            üß™ Test APIClient Connection
        </button>
        <div id="api-test-results" style="background: #222; padding: 10px; border-radius: 5px; min-height: 50px; max-height: 200px; overflow-y: auto;">
            <div style="color: #888;">Klikni na tlaƒç√≠tko pro test...</div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../../shared/logger.js"></script>
    <script src="../../shared/api-client.js"></script>
    <script src="../../shared/navigation.js"></script>
    <script src="admin.js"></script>
</body>
</html>
