<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Modular Quiz App</title>
    <link rel="stylesheet" href="../../shared/common.css">
    <link rel="stylesheet" href="admin.css">
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
    
    <!-- Load Logger first, then APIClient -->
    <script src="../../shared/logger.js"></script>
    <script src="../../shared/api-client.js?v=20250807-admin-fixed"></script>
</head>
<body>
    <!-- Notifications Container -->
    <div id="notifications" class="notifications-container"></div>
    
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1>ğŸ› ï¸ Admin Panel</h1>
            <div class="user-info">
                <span id="userDisplay">ğŸ‘¤ Loading...</span>
                <span id="userRole" class="user-role"></span>
                <button id="toggleApiTest" class="btn btn-secondary" onclick="document.getElementById('api-test-section').style.display = document.getElementById('api-test-section').style.display === 'none' ? 'block' : 'none'" style="margin-right: 10px;">ğŸ”§ API Test</button>
                <button id="logoutBtn" class="btn btn-secondary">OdhlÃ¡sit</button>
            </div>
        </div>
        
        <!-- Navigation Breadcrumbs -->
        <nav class="breadcrumbs">
            <a href="../../index.html">ğŸ  Dashboard</a>
            <span class="separator">â€º</span>
            <span class="current">ğŸ› ï¸ Admin Panel</span>
        </nav>
    </header>

    <!-- Access Control Warning -->
    <div id="accessWarning" class="access-warning" style="display: none;">
        <div class="warning-content">
            <h3>âš ï¸ OmezenÃ½ pÅ™Ã­stup</h3>
            <p>Pro pÅ™Ã­stup k admin panelu potÅ™ebujete admin oprÃ¡vnÄ›nÃ­.</p>
            <button onclick="window.location.href='../auth/login.html'" class="btn btn-primary">
                PÅ™ihlÃ¡sit jako Admin
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content" id="adminContent">

        <!-- Admin Dashboard -->
        <section class="admin-dashboard">
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-icon">ğŸ‘¥</div>
                    <div class="stat-content">
                        <h3 id="totalUsers">0</h3>
                        <p>Celkem uÅ¾ivatelÅ¯</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“š</div>
                    <div class="stat-content">
                        <h3 id="totalTables">0</h3>
                        <p>Tabulek otÃ¡zek</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">â“</div>
                    <div class="stat-content">
                        <h3 id="totalQuestions">0</h3>
                        <p>Celkem otÃ¡zek</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">ğŸ“Š</div>
                    <div class="stat-content">
                        <h3 id="totalAnswers">0</h3>
                        <p>OdpovÄ›dÃ­ dnes</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin Tabs -->
        <section class="admin-tabs">
            <div class="tab-buttons">
                <button class="tab-btn active" data-tab="users">ğŸ‘¥ UÅ¾ivatelÃ©</button>
                <button class="tab-btn" data-tab="questions">â“ OtÃ¡zky</button>
                <button class="tab-btn" data-tab="tables">ğŸ“š Tabulky</button>
                <button class="tab-btn" data-tab="analytics">ğŸ“Š Analytika</button>
                <button class="tab-btn" data-tab="system">âš™ï¸ SystÃ©m</button>
            </div>
            
            <!-- Users Tab -->
            <div id="users-tab" class="tab-content active">
                <div class="tab-header">
                    <h2>ğŸ‘¥ SprÃ¡va UÅ¾ivatelÅ¯</h2>
                    <div class="tab-actions">
                        <button id="refreshUsersBtn" class="btn btn-secondary">ğŸ”„ Obnovit</button>
                        <button id="addUserBtn" class="btn btn-primary">â• PÅ™idat uÅ¾ivatele</button>
                    </div>
                </div>
                
                <div class="users-table-container">
                    <table class="admin-table" id="usersTable">
                        <thead>
                            <tr>
                                <th>UÅ¾ivatel</th>
                                <th>Role</th>
                                <th>Registrace</th>
                                <th>PoslednÃ­ aktivita</th>
                                <th>SprÃ¡vnÄ›/Å patnÄ›</th>
                                <th>Akce</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Questions Tab -->
            <div id="questions-tab" class="tab-content">
                <div class="tab-header">
                    <h2>â“ SprÃ¡va OtÃ¡zek</h2>
                    <div class="tab-actions">
                        <select id="questionTableFilter" class="form-select">
                            <option value="">VÅ¡echny tabulky</option>
                        </select>
                        <button id="refreshQuestionsBtn" class="btn btn-secondary">ğŸ”„ Obnovit</button>
                        <button id="addQuestionBtn" class="btn btn-primary">â• PÅ™idat otÃ¡zku</button>
                        <button id="importQuestionsBtn" class="btn btn-primary">ğŸ“ Import</button>
                    </div>
                </div>
                
                <div class="questions-table-container">
                    <table class="admin-table" id="questionsTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Tabulka</th>
                                <th>OtÃ¡zka</th>
                                <th>SprÃ¡vnÃ¡ odpovÄ›Ä</th>
                                <th>ObtÃ­Å¾nost</th>
                                <th>Akce</th>
                            </tr>
                        </thead>
                        <tbody id="questionsTableBody">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Tables Tab -->
            <div id="tables-tab" class="tab-content">
                <div class="tab-header">
                    <h2>ğŸ“š SprÃ¡va Tabulek</h2>
                    <div class="tab-actions">
                        <button id="refreshTablesBtn" class="btn btn-secondary">ğŸ”„ Obnovit</button>
                        <button id="addTableBtn" class="btn btn-primary">â• VytvoÅ™it tabulku</button>
                    </div>
                </div>
                
                <div class="tables-grid" id="tablesGrid">
                    <!-- Dynamic content -->
                </div>
            </div>
            
            <!-- Analytics Tab -->
            <div id="analytics-tab" class="tab-content">
                <div class="tab-header">
                    <h2>ğŸ“Š Analytika a Statistiky</h2>
                    <div class="tab-actions">
                        <select id="analyticsTimeRange" class="form-select">
                            <option value="today">Dnes</option>
                            <option value="week">Tento tÃ½den</option>
                            <option value="month">Tento mÄ›sÃ­c</option>
                            <option value="all">VÅ¡e</option>
                        </select>
                        <button id="refreshAnalyticsBtn" class="btn btn-secondary">ğŸ”„ Obnovit</button>
                        <button id="exportDataBtn" class="btn btn-primary">ğŸ“¤ Export dat</button>
                    </div>
                </div>
                
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3>ğŸ“ˆ Aktivita uÅ¾ivatelÅ¯</h3>
                        <div class="chart-container">
                            <canvas id="userActivityChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="analytics-card">
                        <h3>ğŸ¯ ÃšspÄ›Å¡nost otÃ¡zek</h3>
                        <div class="chart-container">
                            <canvas id="questionSuccessChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="analytics-card">
                        <h3>âš”ï¸ Battle statistiky</h3>
                        <div id="battleStats" class="battle-stats">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                    
                    <div class="analytics-card">
                        <h3>ğŸ† Top uÅ¾ivatelÃ©</h3>
                        <div id="topUsers" class="top-users-list">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- System Tab -->
            <div id="system-tab" class="tab-content">
                <div class="tab-header">
                    <h2>âš™ï¸ SystÃ©movÃ¡ Administrace</h2>
                    <div class="tab-actions">
                        <button id="systemInfoBtn" class="btn btn-secondary">â„¹ï¸ Info</button>
                        <button id="cleanupBtn" class="btn btn-warning">ğŸ§¹ VyÄistit data</button>
                    </div>
                </div>
                
                <div class="system-grid">
                    <div class="system-card">
                        <h3>ğŸ”§ ÃšdrÅ¾ba databÃ¡ze</h3>
                        <div class="system-actions">
                            <button id="backupDbBtn" class="btn btn-primary">ğŸ’¾ ZÃ¡lohovat DB</button>
                            <button id="repairDbBtn" class="btn btn-warning">ğŸ”§ Opravit DB</button>
                            <button id="optimizeDbBtn" class="btn btn-secondary">âš¡ Optimalizovat</button>
                        </div>
                    </div>
                    
                    <div class="system-card">
                        <h3>ğŸ“Š SystÃ©movÃ© metriky</h3>
                        <div id="systemMetrics" class="metrics-list">
                            <!-- Dynamic content -->
                        </div>
                    </div>
                    
                    <div class="system-card">
                        <h3>ğŸ” BezpeÄnost</h3>
                        <div class="system-actions">
                            <button id="auditLogBtn" class="btn btn-secondary">ğŸ“ Audit log</button>
                            <button id="resetPasswordsBtn" class="btn btn-danger">ğŸ”‘ Reset hesel</button>
                            <button id="lockAccountBtn" class="btn btn-danger">ğŸš« Zablokovat ÃºÄty</button>
                        </div>
                    </div>
                    
                    <div class="system-card">
                        <h3>ğŸš€ Server management</h3>
                        <div class="server-status" id="serverStatus">
                            <div class="status-indicator">ğŸ”´ Offline</div>
                            <div class="status-details">
                                <p>Backend server: <span id="backendStatus">Checking...</span></p>
                                <p>Database: <span id="databaseStatus">Checking...</span></p>
                                <p>Verze: <span id="serverVersion">Unknown</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>â• PÅ™idat novÃ©ho uÅ¾ivatele</h3>
                <button class="modal-close" onclick="closeModal('addUserModal')">Ã—</button>
            </div>
            
            <form id="addUserForm" class="modal-body">
                <div class="form-group">
                    <label for="newUsername">UÅ¾ivatelskÃ© jmÃ©no:</label>
                    <input type="text" id="newUsername" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="newUserEmail">Email:</label>
                    <input type="email" id="newUserEmail" class="form-input">
                </div>
                <div class="form-group">
                    <label for="newUserPassword">Heslo:</label>
                    <input type="password" id="newUserPassword" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="newUserRole">Role:</label>
                    <select id="newUserRole" class="form-select">
                        <option value="user">UÅ¾ivatel</option>
                        <option value="admin">AdministrÃ¡tor</option>
                    </select>
                </div>
            </form>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('addUserModal')">
                    ZruÅ¡it
                </button>
                <button type="submit" form="addUserForm" class="btn btn-primary">
                    â• VytvoÅ™it uÅ¾ivatele
                </button>
            </div>
        </div>
    </div>

    <!-- Add Question Modal -->
    <div id="addQuestionModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>â• PÅ™idat novou otÃ¡zku</h3>
                <button class="modal-close" onclick="closeModal('addQuestionModal')">Ã—</button>
            </div>
            
            <form id="addQuestionForm" class="modal-body">
                <div class="form-group">
                    <label for="questionTable">Tabulka:</label>
                    <select id="questionTable" class="form-select" required>
                        <option value="">Vyberte tabulku</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="questionText">OtÃ¡zka:</label>
                    <textarea id="questionText" class="form-textarea" rows="3" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="answerA">OdpovÄ›Ä A:</label>
                        <input type="text" id="answerA" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="answerB">OdpovÄ›Ä B:</label>
                        <input type="text" id="answerB" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="answerC">OdpovÄ›Ä C:</label>
                        <input type="text" id="answerC" class="form-input" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="correctAnswer">SprÃ¡vnÃ¡ odpovÄ›Ä:</label>
                        <select id="correctAnswer" class="form-select" required>
                            <option value="">Vyberte</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="questionDifficulty">ObtÃ­Å¾nost:</label>
                        <select id="questionDifficulty" class="form-select">
                            <option value="easy">SnadnÃ¡</option>
                            <option value="medium" selected>StÅ™ednÃ­</option>
                            <option value="hard">TÄ›Å¾kÃ¡</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="questionExplanation">VysvÄ›tlenÃ­:</label>
                    <textarea id="questionExplanation" class="form-textarea" rows="2"></textarea>
                </div>
            </form>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('addQuestionModal')">
                    ZruÅ¡it
                </button>
                <button type="submit" form="addQuestionForm" class="btn btn-primary">
                    â• PÅ™idat otÃ¡zku
                </button>
            </div>
        </div>
    </div>

    <!-- API Test Section -->
    <div id="api-test-section" style="position: fixed; bottom: 20px; right: 20px; background: rgba(0,0,0,0.9); color: white; padding: 15px; border-radius: 10px; font-family: 'Courier New', monospace; font-size: 12px; z-index: 1000; width: 300px; border: 2px solid #00ff00; display: none;">
        <div style="display: flex; align-items: center; margin-bottom: 10px;">
            <div id="adminStatusIndicator" style="width: 10px; height: 10px; border-radius: 50%; background: #ff0000; margin-right: 10px;"></div>
            <strong>Admin API Test Panel</strong>
        </div>
        <button id="api-test-btn" onclick="runAdminAPIClientTest()" style="background: #00aa00; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; width: 100%; margin-bottom: 10px; font-weight: bold;">
            ğŸ§ª Test APIClient Connection
        </button>
        <div id="api-test-results" style="background: #222; padding: 10px; border-radius: 5px; min-height: 50px; max-height: 200px; overflow-y: auto;">
            <div style="color: #888;">Klikni na tlaÄÃ­tko pro test...</div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../../shared/logger.js"></script>
    <script src="../../shared/api-client.js"></script>
    <script src="../../shared/navigation.js"></script>
    <script src="admin.js"></script>
</body>
</html>
