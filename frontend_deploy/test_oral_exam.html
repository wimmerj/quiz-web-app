<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test √∫stn√≠ho zkou≈°en√≠</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .log-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Test √∫stn√≠ho zkou≈°en√≠</h1>
        
        <div id="status" class="status info">
            P≈ôipraveno k testov√°n√≠...
        </div>
        
        <div>
            <button class="test-button" onclick="testDataAvailability()">
                Zkontrolovat dostupnost dat
            </button>
            
            <button class="test-button" onclick="testOralExamSystem()">
                Zkontrolovat syst√©m √∫stn√≠ho zkou≈°en√≠
            </button>
            
            <button class="test-button" onclick="simulateOralExam()">
                Simulovat spu≈°tƒõn√≠ √∫stn√≠ho zkou≈°en√≠
            </button>
            
            <button class="test-button" onclick="clearLog()">
                Vymazat log
            </button>
        </div>
        
        <div id="logOutput" class="log-output">
            === Test Log ===
        </div>
    </div>

    <!-- Include all necessary scripts -->
    <script src="quiz_data.js"></script>
    <script src="security_improvements.js"></script>
    <script src="ux_improvements.js"></script>
    <script src="data_management.js"></script>
    <script src="accessibility.js"></script>
    <script src="statistics.js"></script>
    <script src="oral_exam_system.js"></script>
    
    <script>
        // Test functions
        let logOutput = '';
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logOutput += `[${timestamp}] ${message}\n`;
            document.getElementById('logOutput').textContent = logOutput;
            console.log(message);
        }
        
        function setStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }
        
        function clearLog() {
            logOutput = '=== Test Log ===\n';
            document.getElementById('logOutput').textContent = logOutput;
        }
        
        function testDataAvailability() {
            log('Testov√°n√≠ dostupnosti dat...');
            
            if (typeof QUIZ_DATA === 'undefined') {
                log('‚ùå QUIZ_DATA nen√≠ definov√°na');
                setStatus('Data nejsou dostupn√°!', 'error');
                return;
            }
            
            log('‚úÖ QUIZ_DATA je dostupn√°');
            
            if (!QUIZ_DATA.tables) {
                log('‚ùå QUIZ_DATA.tables neexistuje');
                setStatus('Tabulky nejsou dostupn√©!', 'error');
                return;
            }
            
            const tableCount = Object.keys(QUIZ_DATA.tables).length;
            log(`‚úÖ Poƒçet dostupn√Ωch tabulek: ${tableCount}`);
            
            // Test prvn√≠ tabulky
            const firstTable = Object.keys(QUIZ_DATA.tables)[0];
            if (firstTable) {
                const questionCount = QUIZ_DATA.tables[firstTable].questions?.length || 0;
                log(`‚úÖ Prvn√≠ tabulka "${firstTable}" obsahuje ${questionCount} ot√°zek`);
                
                if (questionCount > 0) {
                    const firstQuestion = QUIZ_DATA.tables[firstTable].questions[0];
                    log(`‚úÖ Uk√°zka ot√°zky: "${firstQuestion.otazka.substring(0, 50)}..."`);
                }
            }
            
            setStatus('Data jsou dostupn√° a obsahuj√≠ ot√°zky', 'success');
        }
        
        function testOralExamSystem() {
            log('Testov√°n√≠ syst√©mu √∫stn√≠ho zkou≈°en√≠...');
            
            if (typeof OralExamSystem === 'undefined') {
                log('‚ùå T≈ô√≠da OralExamSystem nen√≠ dostupn√°');
                setStatus('Syst√©m √∫stn√≠ho zkou≈°en√≠ nen√≠ naƒçten!', 'error');
                return;
            }
            
            log('‚úÖ T≈ô√≠da OralExamSystem je dostupn√°');
            
            try {
                const testOralExam = new OralExamSystem();
                log('‚úÖ Instance OralExamSystem byla √∫spƒõ≈°nƒõ vytvo≈ôena');
                
                // Test dostupnosti mod√°ln√≠ho okna
                const modal = document.getElementById('oralExamModal');
                if (modal) {
                    log('‚úÖ Mod√°ln√≠ okno √∫stn√≠ho zkou≈°en√≠ bylo vytvo≈ôeno');
                } else {
                    log('‚ùå Mod√°ln√≠ okno √∫stn√≠ho zkou≈°en√≠ nebylo nalezeno');
                }
                
                // Test dostupnosti select elementu
                const select = document.getElementById('oralExamTable');
                if (select) {
                    log('‚úÖ Select element pro tabulky byl nalezen');
                    log(`‚úÖ Poƒçet opc√≠ v selectu: ${select.options.length}`);
                } else {
                    log('‚ùå Select element pro tabulky nebyl nalezen');
                }
                
                setStatus('Syst√©m √∫stn√≠ho zkou≈°en√≠ je funkƒçn√≠', 'success');
                
            } catch (error) {
                log('‚ùå Chyba p≈ôi vytv√°≈ôen√≠ instance: ' + error.message);
                setStatus('Chyba v syst√©mu √∫stn√≠ho zkou≈°en√≠!', 'error');
            }
        }
        
        function simulateOralExam() {
            log('Simulace spu≈°tƒõn√≠ √∫stn√≠ho zkou≈°en√≠...');
            
            try {
                const testOralExam = new OralExamSystem();
                
                // Zobrazit modal
                testOralExam.showModal();
                log('‚úÖ Modal byl zobrazen');
                
                // Zkontrolovat, ≈æe se naplnily tabulky
                setTimeout(() => {
                    const select = document.getElementById('oralExamTable');
                    const questionCountInput = document.getElementById('questionCount');
                    
                    if (select && select.options.length > 1) {
                        log(`‚úÖ Tabulky byly naplnƒõny (${select.options.length} opc√≠)`);
                        
                        // Vybrat prvn√≠ dostupnou tabulku
                        select.selectedIndex = 1;
                        const selectedTable = select.value;
                        log(`‚úÖ Vybr√°na tabulka: ${selectedTable}`);
                        
                        // Zkontrolovat poƒçet ot√°zek
                        const questionCount = questionCountInput ? questionCountInput.value : 'N/A';
                        log(`‚úÖ Poƒçet ot√°zek nastaven na: ${questionCount}`);
                        
                        // Debug: zkontrolovat dostupnost dat pro vybranou tabulku
                        if (typeof QUIZ_DATA !== 'undefined' && QUIZ_DATA.tables[selectedTable]) {
                            const availableQuestions = QUIZ_DATA.tables[selectedTable].questions.length;
                            log(`‚úÖ Vybran√° tabulka obsahuje ${availableQuestions} ot√°zek`);
                            
                            if (availableQuestions > 0) {
                                const firstQuestion = QUIZ_DATA.tables[selectedTable].questions[0];
                                log(`‚úÖ Prvn√≠ ot√°zka: "${firstQuestion.otazka.substring(0, 40)}..."`);
                                log(`‚úÖ Spr√°vn√° odpovƒõƒè: "${firstQuestion.spravna_odpoved.substring(0, 30)}..."`);
                            }
                        } else {
                            log('‚ùå Data pro vybranou tabulku nejsou dostupn√°');
                        }
                        
                        // Simulovat spu≈°tƒõn√≠ zkou≈°en√≠
                        setTimeout(() => {
                            log('üéØ Simuluji kliknut√≠ na "Zaƒç√≠t zkou≈°en√≠"...');
                            
                            // Zachytit console.log zpr√°vy z syst√©mu
                            const originalConsoleLog = console.log;
                            console.log = function(...args) {
                                const message = args.join(' ');
                                if (message.includes('Spou≈°t√≠m √∫stn√≠ zkou≈°en√≠') ||
                                    message.includes('Celkem dostupn√Ωch ot√°zek') ||
                                    message.includes('P≈ôipraven√© ot√°zky') ||
                                    message.includes('currentQuestions.length') ||
                                    message.includes('CHYBA:')) {
                                    log(`   üîç ${message}`);
                                }
                                originalConsoleLog(...args);
                            };
                            
                            testOralExam.startOralExam();
                            
                            // Obnovit console.log za chv√≠li
                            setTimeout(() => {
                                console.log = originalConsoleLog;
                                
                                // Zkontrolovat v√Ωsledn√Ω stav
                                const settings = document.getElementById('oralExamSettings');
                                const session = document.getElementById('oralExamSession');
                                const results = document.getElementById('oralExamResults');
                                
                                log('üìä V√Ωsledn√Ω stav UI:');
                                log(`   Settings skryto: ${settings?.classList.contains('hidden')}`);
                                log(`   Session zobrazeno: ${session && !session.classList.contains('hidden')}`);
                                log(`   Results zobrazeno: ${results && !results.classList.contains('hidden')}`);
                                
                                if (results && !results.classList.contains('hidden')) {
                                    log('‚ùå PROBL√âM: Aplikace p≈ôeskoƒçila na v√Ωsledky!');
                                } else if (session && !session.classList.contains('hidden')) {
                                    log('‚úÖ SUCCESS: Zkou≈°en√≠ bylo spu≈°tƒõno!');
                                }
                                
                            }, 1000);
                            
                        }, 100);
                        
                    } else {
                        log('‚ùå Tabulky nebyly naplnƒõny');
                        setStatus('Probl√©m s naƒç√≠t√°n√≠m tabulek', 'error');
                    }
                }, 200);
                
                setStatus('Simulace spu≈°tƒõna - zkontrolujte konzoli', 'info');
                
            } catch (error) {
                log('‚ùå Chyba p≈ôi simulaci: ' + error.message);
                setStatus('Chyba p≈ôi simulaci!', 'error');
            }
        }
        
        // Automatick√Ω test p≈ôi naƒçten√≠
        document.addEventListener('DOMContentLoaded', () => {
            log('Str√°nka naƒçtena, spou≈°t√≠m z√°kladn√≠ testy...');
            setTimeout(() => {
                testDataAvailability();
                setTimeout(() => {
                    testOralExamSystem();
                }, 500);
            }, 100);
        });
    </script>
</body>
</html>
