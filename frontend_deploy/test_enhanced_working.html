<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Integration Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        .reset-btn { background: #dc3545; }
        .reset-btn:hover { background: #c82333; }
        .test-btn { background: #28a745; }
        .test-btn:hover { background: #218838; }
        #output {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            min-height: 100px;
            font-family: monospace;
            overflow-y: auto;
            max-height: 300px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üß™ Enhanced Integration Test</h1>
    
    <div class="test-panel">
        <h2>Quick Actions</h2>
        <button onclick="resetAuth()" class="reset-btn">üîÑ Reset Auth Preference</button>
        <button onclick="testDialog()" class="test-btn">üîí Test Auth Dialog</button>
        <button onclick="debugInfo()" class="test-btn">üîß Debug Info</button>
        <button onclick="openQuizApp()">üéØ Open Quiz App</button>
    </div>
    
    <div class="test-panel">
        <h2>Test Output</h2>
        <div id="output"></div>
        <button onclick="clearOutput()">Clear Output</button>
    </div>

    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }

        function resetAuth() {
            localStorage.removeItem('authPreference');
            log('‚úÖ Auth preference reset');
        }

        function testDialog() {
            log('üîí Testing auth preference dialog...');
            
            // Check if enhanced integration is available
            if (typeof window.forceShowAuthDialog === 'function') {
                window.forceShowAuthDialog();
                log('‚úÖ Dialog test function called');
            } else {
                log('‚ùå Enhanced integration not loaded');
                
                // Try to load and test manually
                const script = document.createElement('script');
                script.src = 'enhanced_integration.js';
                script.onload = function() {
                    log('‚úÖ Enhanced integration script loaded');
                    if (typeof window.forceShowAuthDialog === 'function') {
                        window.forceShowAuthDialog();
                    }
                };
                script.onerror = function() {
                    log('‚ùå Failed to load enhanced integration script');
                };
                document.head.appendChild(script);
            }
        }

        function debugInfo() {
            log('üîß Debug Information:');
            log(`Auth Preference: ${localStorage.getItem('authPreference') || 'not set'}`);
            log(`localStorage keys: ${Object.keys(localStorage).length}`);
            
            if (typeof window.debugEnhancedIntegration === 'function') {
                window.debugEnhancedIntegration();
                log('‚úÖ Enhanced integration debug called');
            } else {
                log('‚ùå Enhanced integration debug not available');
            }
        }

        function openQuizApp() {
            window.open('quiz_app.html', '_blank');
        }

        function clearOutput() {
            output.textContent = '';
        }

        // Initial check
        window.addEventListener('load', function() {
            log('üöÄ Test page loaded');
            debugInfo();
        });
    </script>
</body>
</html>
